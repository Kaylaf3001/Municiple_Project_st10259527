@using Municiple_Project_st10259527.Services.DataStructures
@using System.Linq
@model (Municiple_Project_st10259527.Services.DataStructures.Basic<Municiple_Project_st10259527.Models.ServiceRequestModel> Tree, Municiple_Project_st10259527.Services.DataStructures.MinHeap<ServiceRequestPriority, Municiple_Project_st10259527.Models.ServiceRequestModel> Heap, Municiple_Project_st10259527.Services.DataStructures.Graph<Municiple_Project_st10259527.Models.ServiceRequestModel> Graph)

@{
    ViewData["Title"] = "Manage Service Requests";
    Layout = "_AdminLayout";
}

<style>
    :root {
        --primary: #0d2b52;
        --primary-light: #1a4b8c;
        --secondary: #6c757d;
        --success: #198754;
        --info: #0dcaf0;
        --warning: #ffc107;
        --danger: #dc3545;
        --light: #f8f9fa;
        --dark: #212529;
        --border-radius: 0.5rem;
        --box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.05);
        --transition: all 0.3s ease;
    }

    body {
        background-color: #f5f7fa;
    }

    .page-container {
        min-height: calc(100vh - 200px);
        padding: 1.5rem 0 3rem;
    }

    .card {
        border: none;
        border-radius: var(--border-radius);
        background: #fff;
        box-shadow: var(--box-shadow);
        margin-bottom: 1.5rem;
        transition: var(--transition);
        overflow: hidden;
    }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.75rem 1.5rem rgba(0, 0, 0, 0.1);
        }

    .card-header {
        background: var(--primary);
        color: #fff;
        padding: 1.25rem 1.5rem;
        border-bottom: none;
        font-weight: 600;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .card-body {
        padding: 1.5rem;
    }

    .badge {
        padding: 0.5em 0.8em;
        font-size: 0.75rem;
        font-weight: 600;
        border-radius: 50px;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        display: inline-flex;
        align-items: center;
        line-height: 1;
    }

    /* Ensure table badges don't clip and look consistent */
    .table .badge {
        padding: 0.35rem 0.6rem;
        font-size: 0.70rem;
    }

    .priority-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        color: white;
        font-weight: bold;
        font-size: 0.75rem;
    }

    .priority-1 { background-color: #dc3545; }
    .priority-2 { background-color: #fd7e14; }
    .priority-3 { background-color: #20c997; }

    .table-responsive {
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: 0 0 0 1px rgba(0,0,0,0.03);
        background: white;
    }

    .table {
        margin-bottom: 0;
        --bs-table-hover-bg: rgba(13, 43, 82, 0.03);
    }

        .table th {
            background-color: #f8fafc;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #e9ecef;
            color: #64748b;
        }

        .table td {
            padding: 1rem 1.25rem;
            vertical-align: middle;
            border-color: #f1f5f9;
            transition: var(--transition);
        }

        .table tbody tr {
            position: relative;
            transition: var(--transition);
        }

            .table tbody tr:not(:last-child)::after {
                content: '';
                position: absolute;
                left: 50%;
                bottom: 0;
                width: 95%;
                height: 1px;
                background: #f1f5f9;
                transform: translateX(-50%);
            }

            .table tbody tr:hover {
                background-color: #f8fafc;
                transform: translateX(4px);
            }

    .form-control, .form-select {
        border-radius: 0.375rem;
        border: 1px solid #e2e8f0;
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        transition: var(--transition);
    }

    /* Prevent select text/arrow overlap */
    .form-select {
        padding-right: 2.25rem;
        background-position: right 0.6rem center;
        background-size: 16px 12px;
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
        min-height: 2.25rem;
    }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.25rem rgba(13, 43, 82, 0.1);
        }

    .btn {
        border-radius: 0.375rem;
        padding: 0.5rem 1rem;
        font-weight: 500;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
    }

    .btn-outline-primary {
        color: var(--primary);
        border-color: var(--primary);
    }

        .btn-outline-primary:hover {
            background-color: var(--primary);
            border-color: var(--primary);
        }

    .action-form {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .empty-state {
        padding: 3rem 1rem;
        text-align: center;
        color: #64748b;
    }

        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

    .status-badge {
        padding: 0.35rem 0.75rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: capitalize;
    }

    .fade-in {
        animation: fadeIn 0.3s ease-in;
    }

    @@keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @@media (max-width: 992px) {
        .table-responsive {
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
        }
    }

    @@media (max-width: 768px) {
        .action-form {
            flex-direction: column;
        }

        .action-form .btn {
            width: 100%;
            justify-content: center;
        }

        .table-responsive {
            border: none;
            border-radius: 0;
            box-shadow: none;
        }

        .card {
            border-radius: 0;
            margin-bottom: 1rem;
        }
    }
</style>
<div class="container-fluid page-container">
    <form id="antiForgeryForm" method="post" style="display:none;">
        @Html.AntiForgeryToken()
    </form>
    <div class="d-flex justify-content-between align-items-center mb-4 pt-3">
        <div class="d-flex flex-column">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                    <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "Admin")" class="text-decoration-none">Dashboard</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Service Requests</li>
                </ol>
            </nav>
            <div class="d-flex align-items-center gap-3">
                <h2 class="m-0">Service Requests</h2>
                @{
                    var treeRef = Model.Tree;
                    var treeCount = treeRef != null ? treeRef.Count() : 0;
                }
                <span class="badge bg-primary bg-opacity-10 text-primary">
                    @treeCount Total Requests
                </span>
            </div>
            <p class="text-muted mb-0" style="font-size: 0.95rem;">Manage and prioritize service requests from residents</p>
        </div>
        <div></div>
    </div>

    

    <div class="row g-4">
        <div class="col-lg-8 pe-lg-3">
            <div class="card">
                <div class="card-header">All Requests</div>
                <div class="card-body">
                    <div class="card mb-4">
                        <div class="card-body p-3">
                            <form method="get" asp-action="ManageServiceRequest" asp-controller="ServiceRequestAdmin" class="row g-3 align-items-end">
                                <div class="col-md-2">
                                    <label class="form-label small text-muted mb-1">Status</label>
                                    <select name="statusFilter" class="form-select form-select-sm">
                                        <option value="" selected="@string.IsNullOrWhiteSpace(ViewData["StatusFilter"] as string)">All Statuses</option>
                                        <option value="Submitted" selected="@((ViewData["StatusFilter"] as string) == "Submitted")">Submitted</option>
                                        <option value="InProgress" selected="@((ViewData["StatusFilter"] as string) == "InProgress")">In Progress</option>
                                        <option value="OnHold" selected="@((ViewData["StatusFilter"] as string) == "OnHold")">On Hold</option>
                                        <option value="Completed" selected="@((ViewData["StatusFilter"] as string) == "Completed")">Completed</option>
                                        <option value="Cancelled" selected="@((ViewData["StatusFilter"] as string) == "Cancelled")">Cancelled</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small text-muted mb-1">Category</label>
                                    <select name="categoryFilter" class="form-select form-select-sm">
                                        <option value="">All Categories</option>
                                        <option value="Infrastructure" selected="@((ViewData["CategoryFilter"] as string) == "Infrastructure")">Infrastructure</option>
                                        <option value="Safety" selected="@((ViewData["CategoryFilter"] as string) == "Safety")">Safety</option>
                                        <option value="Utilities" selected="@((ViewData["CategoryFilter"] as string) == "Utilities")">Utilities</option>
                                        <option value="Electrical" selected="@((ViewData["CategoryFilter"] as string) == "Electrical")">Electrical</option>
                                        <option value="Waste" selected="@((ViewData["CategoryFilter"] as string) == "Waste")">Waste</option>
                                        <option value="Health and Safety" selected="@((ViewData["CategoryFilter"] as string) == "Health and Safety")">Health and Safety</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label small text-muted mb-1">Priority</label>
                                    <select name="priorityFilter" class="form-select form-select-sm">
                                        <option value="">All Priorities</option>
                                        <option value="1" selected="@((ViewData["PriorityFilter"] as string) == "1")">High (1)</option>
                                        <option value="2" selected="@((ViewData["PriorityFilter"] as string) == "2")">Medium (2)</option>
                                        <option value="3" selected="@((ViewData["PriorityFilter"] as string) == "3")">Low (3)</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label small text-muted mb-1">Location</label>
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
                                        <select name="locationFilter" class="form-select">
                                            <option value="">All Locations</option>
                                            @{
                                                var selectedLocation = ViewData["LocationFilter"] as string;
                                                foreach (var loc in Municiple_Project_st10259527.Services.LocationService.WesternCapeLocations.Values)
                                                {
                                                    <option value="@loc" selected="@(loc == selectedLocation)">@loc</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3 d-flex gap-2">
                                    <button class="btn btn-primary btn-sm flex-grow-1" type="submit">
                                        <i class="bi bi-funnel me-1"></i> Apply Filters
                                    </button>
                                    <a href="@Url.Action("ManageServiceRequest")" class="btn btn-outline-secondary btn-sm" title="Reset Filters">
                                        <i class="bi bi-arrow-counterclockwise"></i>
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 80px;">ID</th>
                                    <th>Request Details</th>
                                    <th style="min-width: 180px;">Status</th>
                                    <th style="width: 100px;">Priority</th>
                                    <th style="width: 180px;" class="text-end">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    var hasAnyRows = Model.Tree != null && Model.Tree.Root != null;
                                }
                                @if (!hasAnyRows)
                                {
                                    <tr>
                                        <td colspan="5" class="text-center p-5">
                                            <div class="empty-state">
                                                <i class="bi bi-inbox"></i>
                                                <h5 class="mt-2 mb-1">No service requests found</h5>
                                                <p class="text-muted mb-0">Try adjusting your filters or check back later.</p>
                                                <a href="@Url.Action("ManageServiceRequest")" class="btn btn-sm btn-outline-primary mt-3">
                                                    <i class="bi bi-arrow-clockwise"></i> Reset Filters
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                }
                                else
                                {
                                    await RenderNodeSimple(Model.Tree.Root);
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 ps-lg-2">

<div class="card mb-3">
    <div class="card-header d-flex align-items-center justify-content-between">
        <span><i class="bi bi-star-fill text-warning me-2"></i>Next by Priority</span>
        <span class="badge bg-warning bg-opacity-10 text-warning">
            <i class="bi bi-lightning-charge-fill"></i> High Priority
        </span>
    </div>
                <div class="card-body">
                    @{
                        var heapRef = Model.Heap;
                        if (heapRef == null)
                        {
                            <div class="text-muted">No pending requests</div>
                        }
                        else
                        {
                            var top = heapRef.Peek();
                            if (top.Item2 == null)
                            {
                                <div class="text-muted">No pending requests</div>
                            }
                            else
                            {
                            <div class="d-flex align-items-start">
                                <div class="me-3">
                                    <span class="priority-badge priority-@top.Item2.Priority" style="width: 32px; height: 32px; font-size: 1rem;">
                                        @top.Item2.Priority
                                    </span>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1 fw-semibold">@top.Item2.Title</h6>
                                    <div class="small text-muted d-flex flex-wrap gap-2 align-items-center">
                                        <span><i class="bi bi-tag"></i> @top.Item2.Category</span>
                                        <span class="text-muted">•</span>
                                        <span><i class="bi bi-geo-alt"></i> @top.Item2.Location</span>
                                        <span class="text-muted">•</span>
                                        <span><i class="bi bi-calendar"></i> <span class="local-datetime" data-utc="@top.Item2.SubmittedAt.ToString("o")">@top.Item2.SubmittedAt.ToString("g")</span></span>
                                    </div>
                                    <div class="mt-2">
                                        <span class="badge rounded-pill @Badge(top.Item2.Status)">
                                            @top.Item2.Status
                                        </span>
                                    </div>
                                </div>
                            </div>
                            }
                        }
                    }
                </div>
            </div>

            <div class="card">
                <div class="card-header d-flex align-items-center justify-content-between">
                    <span><i class="bi bi-lightning me-2"></i>Top 5 Urgent</span>
                    <span class="badge bg-danger bg-opacity-10 text-danger"><i class="bi bi-exclamation-diamond"></i> Urgency</span>
                </div>
                <div class="card-body">
                    @{
                        var fromService = (ViewBag.TopUrgent as IEnumerable<Municiple_Project_st10259527.Models.ServiceRequestModel>)
                                            ?.Where(r => r.Status != Municiple_Project_st10259527.Models.ServiceRequestStatus.Completed)
                                            .ToList()
                                            ?? new List<Municiple_Project_st10259527.Models.ServiceRequestModel>();
                        var merged = new List<Municiple_Project_st10259527.Models.ServiceRequestModel>(fromService);
                        if (merged.Count < 5 && Model.Heap != null)
                        {
                            var fill = Model.Heap.TopK(5).ToList();
                            foreach (var x in fill)
                            {
                                if (x.Status == Municiple_Project_st10259527.Models.ServiceRequestStatus.Completed) continue;
                                if (!merged.Any(m => m.RequestId == x.RequestId)) merged.Add(x);
                                if (merged.Count >= 5) break;
                            }
                        }
                        var topList = merged.Take(5).ToList();
                        if (!topList.Any())
                        {
                            <div class="text-muted">No pending requests</div>
                        }
                        else
                        {
                            <div class="list-group list-group-flush">
                                @foreach (var r in topList)
                                {
                                    <a asp-action="Detail" asp-route-id="@r.RequestId" class="list-group-item list-group-item-action">
                                        <div class="d-flex align-items-center">
                                            <span class="priority-badge priority-@r.Priority me-3">@r.Priority</span>
                                            <div class="flex-grow-1">
                                                <div class="d-flex justify-content-between">
                                                    <span class="fw-semibold text-truncate" style="max-width:220px">@r.Title</span>
                                                    <span class="badge rounded-pill @Badge(r.Status)">@r.Status</span>
                                                </div>
                                                <div class="small text-muted">
                                                    <i class="bi bi-tag"></i> @r.Category
                                                    <span class="mx-1">•</span>
                                                    <i class="bi bi-geo-alt"></i> @r.Location
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                }
                            </div>
                        }
                    }
                </div>
            </div>
         

            <!-- Traversal from Request Card (BFS) -->
            @{ 
                var startIdObj = ViewData["StartId"]; 
                int parsedStartId = 0;
                bool hasStart = startIdObj != null && int.TryParse(Convert.ToString(startIdObj), out parsedStartId);
                var graphRef = Model.Graph;
                Municiple_Project_st10259527.Services.DataStructures.Graph<Municiple_Project_st10259527.Models.ServiceRequestModel>.GraphNode startNode = null;
                if (hasStart && graphRef != null)
                {
                    var nodesList = graphRef.Nodes();
                    if (nodesList != null)
                    {
                        startNode = nodesList.FirstOrDefault(n => n.Val != null && n.Val.RequestId == parsedStartId);
                    }
                }
            }
            @if (hasStart)
            {
                <div class="card">
                    <div class="card-header d-flex align-items-center">
                        <i class="bi bi-diagram-3 me-2"></i> Request Traversal
                        <span class="ms-auto badge bg-info bg-opacity-10 text-info">
                            <i class="bi bi-shuffle"></i> BFS Traversal
                        </span>
                    </div>
                    <div class="card-body">
                        @if (startNode == null)
                        {
                            <div class="text-muted">Start request not found in graph.</div>
                        }
                        else if (Model.Graph != null && startNode != null)
                        {
                            var bfsResult = Model.Graph.Bfs(startNode);
                            var bfs = (bfsResult ?? Enumerable.Empty<Municiple_Project_st10259527.Models.ServiceRequestModel>())
                                      .Take(8)
                                      .ToList();
                            if (!bfs.Any())
                            {
                                <div class="text-muted">No connected requests found.</div>
                            }
                            else
                            {
                                <div class="list-group list-group-flush">
                                @foreach (var r in bfs)
                                {
                                    <a asp-action="Detail" asp-route-id="@r.RequestId" class="list-group-item list-group-item-action">
                                        <div class="d-flex align-items-start">
                                            <div class="me-3">
                                                <span class="priority-badge priority-@r.Priority" style="width: 24px; height: 24px; font-size: 0.7rem;">
                                                    @r.Priority
                                                </span>
                                            </div>
                                            <div class="flex-grow-1">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <h6 class="mb-1 fw-semibold text-truncate" style="max-width: 200px;">@r.Title</h6>
                                                    <span class="badge rounded-pill @Badge(r.Status)" style="font-size: 0.65rem;">
                                                        @r.Status
                                                    </span>
                                                </div>
                                                <div class="small text-muted">
                                                    <span><i class="bi bi-tag"></i> @r.Category</span>
                                                    <span class="mx-1">•</span>
                                                    <span><i class="bi bi-geo-alt"></i> @r.Location</span>
                                                </div>
                                                <div class="small text-muted mt-1">
                                                    <i class="bi bi-arrow-return-right"></i> Connected via BFS traversal
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                }
                                </div>
                            }
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@functions {
    private string GetConnectionReason(Municiple_Project_st10259527.Models.ServiceRequestModel r1, Municiple_Project_st10259527.Models.ServiceRequestModel r2, int weight)
    {
        if (r1.Status == r2.Status) return "Same status";
        if (!string.IsNullOrEmpty(r1.Category) && r1.Category == r2.Category) return "Same category";
        if (!string.IsNullOrEmpty(r1.Location) && r1.Location == r2.Location) return "Same location";
        return "Related";
    }

    private string Badge(Municiple_Project_st10259527.Models.ServiceRequestStatus status)
    {
        return status switch
        {
            Municiple_Project_st10259527.Models.ServiceRequestStatus.Submitted => "bg-warning text-dark bg-opacity-10 border border-warning border-opacity-25",
            Municiple_Project_st10259527.Models.ServiceRequestStatus.InProgress => "bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25",
            Municiple_Project_st10259527.Models.ServiceRequestStatus.OnHold => "bg-secondary bg-opacity-10 text-secondary border border-secondary border-opacity-25",
            Municiple_Project_st10259527.Models.ServiceRequestStatus.Completed => "bg-success bg-opacity-10 text-success border border-success border-opacity-25",
            Municiple_Project_st10259527.Models.ServiceRequestStatus.Cancelled => "bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25",
            _ => "bg-secondary bg-opacity-10 text-secondary border border-secondary border-opacity-25"
        };
    }

    private async Task RenderNodeSimple(Municiple_Project_st10259527.Services.DataStructures.Node<Municiple_Project_st10259527.Models.ServiceRequestModel> node)
    {
        if (node == null) return;
        var r = node.Value;
        <tr>
            <td class="font-monospace fw-semibold">#@r.RequestId</td>
            <td>
                <div class="d-flex flex-column">
                    <div class="fw-medium text-truncate" style="max-width: 300px;">@r.Title</div>
                    <div class="small text-muted d-flex align-items-center gap-2">
                        <span><i class="bi bi-tag"></i> @r.Category</span>
                        <span class="text-muted">•</span>
                        <span><i class="bi bi-geo-alt"></i> @r.Location</span>
                    </div>
                </div>
            </td>
            <td>
                <span class="status-badge rounded-pill @Badge(r.Status)">
                    @switch (r.Status.ToString())
                    {
                        case "Submitted":
                            <i class="bi bi-clock-history me-1"></i>@r.Status
                            break;
                        case "InProgress":
                            <i class="bi bi-arrow-repeat me-1"></i>@r.Status
                            break;
                        case "Completed":
                            <i class="bi bi-check-circle me-1"></i>@r.Status
                            break;
                        case "OnHold":
                            <i class="bi bi-pause-circle me-1"></i>@r.Status
                            break;
                        case "Cancelled":
                            <i class="bi bi-x-circle me-1"></i>@r.Status
                            break;
                        default:
                            @r.Status
                            break;
                    }
                </span>
            </td>
            <td>
                <span class="priority-badge priority-@r.Priority" title="Priority @r.Priority">
                    @r.Priority
                </span>
            </td>
            <td class="text-end">
                <div class="d-flex justify-content-end gap-2">
                    <a asp-action="Detail" asp-route-id="@r.RequestId" class="btn btn-sm btn-outline-primary" title="View details">
                        <i class="bi bi-eye"></i>
                    </a>
                    <a asp-action="ManageServiceRequest"
                       asp-route-startId="@r.RequestId"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       asp-route-categoryFilter="@ViewData["CategoryFilter"]"
                       asp-route-priorityFilter="@ViewData["PriorityFilter"]"
                       asp-route-locationFilter="@ViewData["LocationFilter"]"
                       class="btn btn-sm btn-outline-secondary"
                       title="Explore related requests">
                        <i class="bi bi-diagram-3"></i>
                    </a>
                    
            </td>
        </tr>
        await RenderNodeSimple(node.FirstChild);
        await RenderNodeSimple(node.NextSibling);
    }
}

<script>
// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Bootstrap tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Convert UTC dates to local time
    document.querySelectorAll('.local-datetime').forEach(function(element) {
        const utcDate = new Date(element.getAttribute('data-utc'));
        if (!isNaN(utcDate.getTime())) {
            element.textContent = utcDate.toLocaleString(undefined, {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
        }
    });

    // Add animation to cards on scroll
    const animateOnScroll = function() {
        const cards = document.querySelectorAll('.card, .list-group-item');
        cards.forEach((card, index) => {
            const cardTop = card.getBoundingClientRect().top;
            const windowHeight = window.innerHeight;
            if (cardTop < windowHeight - 50) {
                setTimeout(() => {
                    card.classList.add('fade-in');
                }, index * 100);
            }
        });
    };

    // Run once on load
    animateOnScroll();
    
    // And on scroll
    window.addEventListener('scroll', animateOnScroll);

    // Existing modal code
    const requestModal = document.getElementById('requestModal');
    if (requestModal) {
        requestModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const id = button.getAttribute('data-id');
        document.getElementById('modal-id').textContent = id;
        const formId = document.getElementById('form-id');
        const formPriority = document.getElementById('form-priority');
        formId.value = id;
        document.getElementById('modal-title').textContent = button.getAttribute('data-title');
        document.getElementById('modal-description').textContent = button.getAttribute('data-description');
        document.getElementById('modal-location').textContent = button.getAttribute('data-location');
        document.getElementById('modal-category').textContent = button.getAttribute('data-category');
        const status = button.getAttribute('data-status');
        const statusSelect = document.getElementById('modal-status-select');
        statusSelect.value = status;
        const currentPriority = button.getAttribute('data-priority');
        document.getElementById('modal-priority').textContent = 'Priority ' + currentPriority;
        formPriority.value = currentPriority;
        document.getElementById('modal-userid').textContent = button.getAttribute('data-userid');

        // No extra JS submit handler needed; form posts directly with anti-forgery token
    });

    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});

 
</script>

 

 

<style>
    /* Toast styles */
    .toast {
        min-width: 250px;
        margin-bottom: 1rem;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        animation: fadeIn 0.3s ease-out;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>